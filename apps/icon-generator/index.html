<!DOCTYPE html>
<html>
<head>
  <title>Generate Extension Icons from SVG</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 20px;
      background: #f3f4f6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    h1 {
      color: #1e293b;
      margin-bottom: 20px;
    }
    .instructions {
      background: #eff6ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #2563eb;
    }
    .upload-section {
      margin: 20px 0;
    }
    .icon-preview {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .icon-item {
      text-align: center;
    }
    canvas {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin-top: 10px;
    }
    button:hover {
      background: #1d4ed8;
    }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .size-label {
      margin-top: 8px;
      font-size: 12px;
      color: #6b7280;
      font-weight: 600;
    }
    .upload-btn {
      font-size: 16px;
      padding: 12px 24px;
    }
    .download-all-btn {
      margin-left: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Generate Extension Icons from SVG</h1>

    <div class="instructions">
      <strong>Instructions:</strong>
      <ol style="margin: 10px 0 0 0; padding-left: 20px;">
        <li>Upload an SVG file using the button below</li>
        <li>Icons will be generated automatically in multiple sizes</li>
        <li>Click "Download" on each icon or "Download All" to get a ZIP file</li>
        <li>Save them as: icon16.png, icon32.png, icon48.png, and icon128.png</li>
        <li>Place the files in your extension folder</li>
      </ol>
    </div>

    <div class="upload-section">
      <input type="file" id="svgUpload" accept=".svg,image/svg+xml" style="display: none;">
      <button class="upload-btn" onclick="document.getElementById('svgUpload').click()">
        Upload SVG File
      </button>
      <button id="downloadAllBtn" class="download-all-btn" onclick="downloadAll()">
        Download All as ZIP
      </button>
    </div>

    <div class="icon-preview" id="iconPreview"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    const sizes = [16, 32, 48, 128];
    const iconPreview = document.getElementById('iconPreview');
    const svgUpload = document.getElementById('svgUpload');
    const downloadAllBtn = document.getElementById('downloadAllBtn');
    let canvasElements = [];

    svgUpload.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const svgContent = event.target.result;
        generateIcons(svgContent);
      };
      reader.readAsText(file);
    });

    function generateIcons(svgContent) {
      iconPreview.innerHTML = '';
      canvasElements = [];

      sizes.forEach(size => {
        const container = document.createElement('div');
        container.className = 'icon-item';

        const canvas = document.createElement('canvas');
        canvas.width = size;
        canvas.height = size;
        canvasElements.push({ canvas, size });

        const img = new Image();
        const blob = new Blob([svgContent], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(blob);

        img.onload = function() {
          const ctx = canvas.getContext('2d');
          ctx.clearRect(0, 0, size, size);
          ctx.drawImage(img, 0, 0, size, size);
          URL.revokeObjectURL(url);
        };

        img.onerror = function() {
          console.error('Failed to load SVG');
          URL.revokeObjectURL(url);
        };

        img.src = url;

        const label = document.createElement('div');
        label.className = 'size-label';
        label.textContent = `${size}x${size}`;

        const downloadBtn = document.createElement('button');
        downloadBtn.textContent = 'Download';
        downloadBtn.onclick = () => {
          const link = document.createElement('a');
          link.download = `icon${size}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
        };

        container.appendChild(canvas);
        container.appendChild(label);
        container.appendChild(downloadBtn);
        iconPreview.appendChild(container);
      });

      downloadAllBtn.style.display = 'inline-block';
    }

    async function downloadAll() {
      const zip = new JSZip();

      for (const item of canvasElements) {
        const dataUrl = item.canvas.toDataURL('image/png');
        const base64Data = dataUrl.split(',')[1];
        zip.file(`icon${item.size}.png`, base64Data, { base64: true });
      }

      const content = await zip.generateAsync({ type: 'blob' });
      const link = document.createElement('a');
      link.download = 'icons.zip';
      link.href = URL.createObjectURL(content);
      link.click();
      URL.revokeObjectURL(link.href);
    }
  </script>
</body>
</html>
